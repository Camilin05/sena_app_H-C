{% extends 'base.html' %}

{% block title %}Directorio de Instructores - Sistema Integral SENA{% endblock %}

{% block content %}
<div class="contenido_la">
<div class="encabezado-pagina animacion-entrada">
    <div class="contenedor-encabezado">
        <div class="info-encabezado">
            <h2>Directorio de Instructores SENA</h2>
            <p class="subtitulo-encabezado">Gestión integral del cuerpo docente institucional</p>
        </div>
        <div class="controles-encabezado">
            <div class="insignia-total">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Total: {{ total_instructores|default:"0" }} instructores</span>
            </div>
            <a href="{% url 'admin:instructores_instructor_add' %}" class="boton-nuevo">
                <i class="fas fa-plus"></i>
                Registrar Instructor
            </a>
        </div>
    </div>
</div>

<div class="seccion-estadisticas">
    <div class="tarjeta-estadistica animacion-entrada">
        <div class="numero-estadistica">{{ instructores_activos|default:"0" }}</div>
        <div class="label-estadistica">Instructores Activos</div>
    </div>
    <div class="tarjeta-estadistica animacion-entrada">
        <div class="numero-estadistica">{{ instructores_presenciales|default:"0" }}</div>
        <div class="label-estadistica">Modalidad Presencial</div>
    </div>
    <div class="tarjeta-estadistica animacion-entrada">
        <div class="numero-estadistica">{{ instructores_virtuales|default:"0" }}</div>
        <div class="label-estadistica">Modalidad Virtual</div>
    </div>
    <div class="tarjeta-estadistica animacion-entrada">
        <div class="numero-estadistica">{{ total_instructores|default:"0" }}</div>
        <div class="label-estadistica">Total Registrados</div>
    </div>
</div>

<div class="seccion-filtros animacion-entrada">
    <div class="contenedor-filtros">
        <div class="campo-busqueda">
            <i class="fas fa-search icono-busqueda"></i>
            <input type="text" class="entrada-busqueda" placeholder="Buscar por nombre, documento, especialidad..." id="campoBusqueda">
        </div>
        <select class="filtro-select" id="filtroEstado">
            <option value="">Todos los estados</option>
            <option value="ACTIVO">Activos</option>
            <option value="INACTIVO">Inactivos</option>
            <option value="VACACIONES">En Vacaciones</option>
            <option value="LICENCIA">En Licencia</option>
        </select>
        <select class="filtro-select" id="filtroModalidad">
            <option value="">Todas las modalidades</option>
            <option value="PRESENCIAL">Presencial</option>
            <option value="VIRTUAL">Virtual</option>
            <option value="MIXTA">Mixta</option>
        </select>
        <button class="boton-filtro" onclick="exportarDatos()">
            <i class="fas fa-download"></i>
            Exportar
        </button>
    </div>
</div>

<section class="sectionla">
{% if instructores %}
<div class="contenedor-tabla animacion-entrada aparecer">
    <table class="tabla-moderna">
        <thead>
            <tr>
                <th><i class="fas fa-id-badge"></i> Código</th>
                <th><i class="fas fa-user"></i> Instructor</th>
                <th><i class="fas fa-envelope"></i> Contacto</th>
                <th><i class="fas fa-graduation-cap"></i> Especialidad</th>
                <th><i class="fas fa-desktop"></i> Modalidad</th>
                <th><i class="fas fa-circle"></i> Estado</th>
                <th><i class="fas fa-calendar"></i> Ingreso</th>
                <th><i class="fas fa-cogs"></i> Acciones</th>
            </tr>
        </thead>
        <tbody id="tablaInstructores">
            {% for instructor in instructores %}
            <tr class="fila-instructor" 
                data-estado="{{ instructor.estado }}" 
                data-modalidad="{{ instructor.modalidad_trabajo }}">
                <td>
                <a href="{% url 'instructores:detalle_instructor' instructor.id %}">
                    <span class="codigo-destacado">{{ instructor.codigo_instructor }}</span>
                </a>
                </td>
                <td>
                    <div>
                        
                        <div class="nombre-instructor">{{ instructor.nombre_completo }}</div>
                        <div class="documento-instructor">{{ instructor.get_tipo_documento_display }}: {{ instructor.documento_identidad }}</div>
                    </div>
                </td>
                <td>
                    <div>
                        <a href="mailto:{{ instructor.correo_electronico }}" class="enlace-correo">
                            {{ instructor.correo_electronico }}
                        </a>
                        <div class="documento-instructor">{{ instructor.telefono_principal }}</div>
                    </div>
                </td>
                <td>
                    <span class="especialidad-etiqueta">{{ instructor.especialidad }}</span>
                    <div class="documento-instructor">{{ instructor.experiencia_anos }} años exp.</div>
                </td>
                <td>
                    <div>
                        {% if instructor.modalidad_trabajo == 'PRESENCIAL' %}
                            <i class="fas fa-building modalidad-icono" style="color: var(--verde-primario);"></i>
                        {% elif instructor.modalidad_trabajo == 'VIRTUAL' %}
                            <i class="fas fa-laptop modalidad-icono" style="color: #007bff;"></i>
                        {% else %}
                            <i class="fas fa-blender modalidad-icono" style="color: #6f42c1;"></i>
                        {% endif %}
                        {{ instructor.get_modalidad_trabajo_display }}
                    </div>
                </td>
                <td>
                    <span class="estado-etiqueta estado-{{ instructor.estado|lower }}">
                        {% if instructor.estado == 'ACTIVO' %}
                            <i class="fas fa-check-circle"></i>
                        {% elif instructor.estado == 'INACTIVO' %}
                            <i class="fas fa-times-circle"></i>
                        {% elif instructor.estado == 'VACACIONES' %}
                            <i class="fas fa-umbrella-beach"></i>
                        {% else %}
                            <i class="fas fa-pause-circle"></i>
                        {% endif %}
                        {{ instructor.get_estado_display }}
                    </span>
                </td>
                <td>
                    <span class="fecha-formateada">{{ instructor.fecha_ingreso|date:"d/m/Y" }}</span>
                </td>
                <td>
                    <a href="{% url 'admin:instructores_instructor_change' instructor.pk %}" 
                        class="boton-accion" title="Editar información del instructor">
                        <i class="fas fa-edit"></i>
                        Editar
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="estado-vacio">
    <div class="icono-vacio">
        <i class="fas fa-chalkboard-teacher"></i>
    </div>
    <h3 class="titulo-vacio">No hay instructores registrados</h3>
    <p class="descripcion-vacio">
        Actualmente no se encuentran instructores registrados en el sistema institucional.<br>
        Inicie el proceso de registro para comenzar a gestionar el cuerpo docente.
    </p>
    <a href="{% url 'admin:instructores_instructor_add' %}" class="boton-accion-vacio">
        <i class="fas fa-plus"></i>
        Registrar Primer Instructor
    </a>
</div>
{% endif %}
</section>
<script>
    document.getElementById('campoBusqueda').addEventListener('input', function(e) {
        filtrarInstructores();
    });

    document.getElementById('filtroEstado').addEventListener('change', function(e) {
        filtrarInstructores();
    });

    document.getElementById('filtroModalidad').addEventListener('change', function(e) {
        filtrarInstructores();
    });

    function filtrarInstructores() {
        const terminoBusqueda = document.getElementById('campoBusqueda').value.toLowerCase();
        const filtroEstado = document.getElementById('filtroEstado').value;
        const filtroModalidad = document.getElementById('filtroModalidad').value;
        const filas = document.querySelectorAll('.fila-instructor');
        
        filas.forEach(fila => {
            const texto = fila.textContent.toLowerCase();
            const estado = fila.getAttribute('data-estado');
            const modalidad = fila.getAttribute('data-modalidad');
            
            const coincideTexto = texto.includes(terminoBusqueda);
            const coincideEstado = !filtroEstado || estado === filtroEstado;
            const coincideModalidad = !filtroModalidad || modalidad === filtroModalidad;
            
            if (coincideTexto && coincideEstado && coincideModalidad) {
                fila.style.display = '';
                fila.classList.add('aparecer');
            } else {
                fila.style.display = 'none';
                fila.classList.remove('aparecer');
            }
        });

        // Actualizar contador de resultados
        const filasVisibles = document.querySelectorAll('.fila-instructor[style=""]').length;
        actualizarContadorResultados(filasVisibles);
    }

    function actualizarContadorResultados(cantidad) {
        const insignia = document.querySelector('.insignia-total span');
        if (cantidad === {{ total_instructores|default:"0" }}) {
            insignia.textContent = `Total: ${cantidad} instructores`;
        } else {
            insignia.textContent = `Mostrando: ${cantidad} de {{ total_instructores|default:"0" }} instructores`;
        }
    }

    function exportarDatos() {
        alert('Funcionalidad de exportación - Próximamente disponible');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const elementos = document.querySelectorAll('.animacion-entrada');
        elementos.forEach((elemento, indice) => {
            elemento.style.animationDelay = `${indice * 0.1}s`;
        });

        const filas = document.querySelectorAll('.fila-instructor');
        filas.forEach(fila => {
            fila.addEventListener('mouseenter', function() {
                this.style.background = 'rgba(40, 167, 69, 0.08)';
                this.style.transform = 'scale(1.02)';
                this.style.boxShadow = '0 4px 15px rgba(40, 167, 69, 0.1)';
            });
            
            fila.addEventListener('mouseleave', function() {
                this.style.background = '';
                this.style.transform = '';
                this.style.boxShadow = '';
            });
        });

        const numerosEstadisticas = document.querySelectorAll('.numero-estadistica');
        
        const observador = new IntersectionObserver((entradas) => {
            entradas.forEach(entrada => {
                if (entrada.isIntersecting) {
                    const numero = entrada.target;
                    const valorFinal = parseInt(numero.textContent);
                    let valorActual = 0;
                    const incremento = valorFinal / 30;
                    
                    const timer = setInterval(() => {
                        valorActual += incremento;
                        if (valorActual >= valorFinal) {
                            numero.textContent = valorFinal;
                            clearInterval(timer);
                        } else {
                            numero.textContent = Math.floor(valorActual);
                        }
                    }, 50);
                }
            });
        });
        
        numerosEstadisticas.forEach(numero => observador.observe(numero));
    });

    document.querySelectorAll('.boton-accion, .boton-nuevo, .boton-filtro').forEach(boton => {
        boton.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.classList.add('ripple');
            
            this.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });
</script>

</div>
{% endblock %}